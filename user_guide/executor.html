<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Executor Class &mdash; sQUlearn 0.9.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
      <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css?v=572af1d6" />
      <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=a63e3025" />

  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="canonical" href="https://squlearn.github.io/user_guide/executor.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=9dc39874"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Observables for expectation values" href="observables.html" />
    <link rel="prev" title="User Guide" href="user_guide_index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.9.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install/install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="user_guide_index.html">User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">The Executor Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-features-of-the-executor">Key Features of the Executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initialization-of-the-executor-class">Initialization of the Executor class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utilizing-executor-primitives-in-qiskit-routines">Utilizing Executor Primitives in Qiskit Routines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-options-for-qiskit-primitives">Setting Options for Qiskit Primitives</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatic-backend-selection-ibm-quantum-only">Automatic backend selection (IBM Quantum only)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#in-qpu-parallelization-qiskit-only">In-QPU parallelization (Qiskit only)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="observables.html">Observables for expectation values</a></li>
<li class="toctree-l2"><a class="reference internal" href="encoding_circuits.html">Quantum Encoding Circuits</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_methods.html">Quantum Kernel Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="quantum_neural_networks.html">Quantum Neural Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="quantum_reservoir_computing.html">Quantum Reservoir Computing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/classes.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/examples_index.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sQUlearn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="user_guide_index.html">User Guide</a></li>
      <li class="breadcrumb-item active">The Executor Class</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user_guide/executor.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-executor-class">
<span id="executor-user-guide"></span><h1>The Executor Class<a class="headerlink" href="#the-executor-class" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class is the central component of sQUlearn, responsible
for running all quantum jobs.
Both high- and low-level methods utilize the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class to execute circuits or to run other
quantum jobs.
The class provides a high-level interface to the simulators of PennyLane, Qiskit and Qulacs,
as well as manages access to real QC hardware as for example IBM Quantum.
It features a variety of comfort features, such as result caching,
automatic restarts of failed jobs, logging of all actions, and Qiskit Session handling.
The <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class is also responsible for handling the execution environment, and can be
initialized with a variety of objects that specify the execution environment (see figure below).
The following figure summarizes the structure of the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class; ingoing arrows indicate
that the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class can be initialized or adjusted with the corresponding object.
Outgoing arrows indicate that the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class can return the corresponding object.</p>
<a class="reference internal image-reference" href="../_images/executor.png"><img alt="../_images/executor.png" class="align-center" src="../_images/executor.png" style="width: 600px;" /></a>
</section>
<section id="key-features-of-the-executor">
<h2>Key Features of the Executor<a class="headerlink" href="#key-features-of-the-executor" title="Link to this heading"></a></h2>
<p>The <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class provides the following key comfort features when executing a quantum job:</p>
<ul class="simple">
<li><p><strong>Result caching:</strong> Enables caching of results to avoid redundant job executions, and enable
restarts of failed executions. Caching is enabled as default for remote executions, but can also
be manually activated for local execution.
The cached files are named after the hash out of different properties of the quantum job,
that include the backend name, the circuit, the execution options, etc.
Before running a job, the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> checks if a cached result exists and returns it if it does.
The caching can be disabled by setting the <code class="docutils literal notranslate"><span class="pre">caching</span></code> argument to <code class="docutils literal notranslate"><span class="pre">False</span></code>; the folder for
the cached results can be specified by the <code class="docutils literal notranslate"><span class="pre">cache_dir</span></code> argument,
(default folder: <code class="docutils literal notranslate"><span class="pre">&quot;_cache&quot;</span></code>).</p></li>
<li><p><strong>Automatic restarts:</strong> In case the job execution fails or is canceled, the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a>
automatically resubmits and restarts the job up to a specified number of times.
The number of restarts can be specified via the <code class="docutils literal notranslate"><span class="pre">max_jobs_retries</span></code> argument, the pause
between restarts can be adjusted by the <code class="docutils literal notranslate"><span class="pre">wait_restart</span></code> argument.</p></li>
<li><p><strong>Logging:</strong> The <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> automatically logs all actions to a log file that ca be specified
via the <code class="docutils literal notranslate"><span class="pre">log_file</span></code> argument.</p></li>
<li><p><strong>Random Seeds for shot-based simulators:</strong> A random seeds can be specified for the PennyLane
and Qiskit shot-based simulators / fake backends to make the computations utilizing this <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> object
reproducible. The random seeds can be set manually by specifying the <code class="docutils literal notranslate"><span class="pre">seed</span></code> argument.</p></li>
<li><p><strong>Modified Qiskit Primitives:</strong> The <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> allows the creation of modified Qiskit Primitives
that function exactly as the <a class="reference external" href="https://quantum.cloud.ibm.com/docs/api/qiskit/primitives#module-qiskit.primitives" title="(in Qiskit v2.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Qiskit</span> <span class="pre">primitives</span></code></a> but leverage the comfort features mentioned above.
The primitives can be obtained utilizing the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor.get_estimator" title="squlearn.Executor.get_estimator"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_estimator()</span></code></a> and
<a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor.get_sampler" title="squlearn.Executor.get_sampler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_sampler()</span></code></a> methods. The modified primitives route all executions through the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a>
class, and thus benefit from all comfort features. The primitives are fully compatible with
the Qiskit framework, and can be used in the same way as regular primitives.
The <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> primitives are automatically utilized in the sQUlearn
sub-programs. If the version of the Qiskit installation is larger equal than 1.2, the V2 Primitives are created, otherwise the V1 Primitives are returned.</p></li>
<li><p><strong>Qiskit Session handling:</strong> Automatically manages the creation and handling of Qiskit IBM Runtime sessions.
If Sessions are time out, the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> automatically creates a new session and re-executes the
job. Note that a manual closing of the session is reuqired when running in jupyter notebook, since otherwise unncessary runtime on the IBM Quantum Machines might be a consequence.</p></li>
<li><p><strong>Automatic backend selection (IBM Quantum only):</strong> The <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class can automatically select the most suitable
backend for the quantum job. The selection process is facilitated by the <a class="reference external" href="https://github.com/qiskit-community/mapomatic">mapomatic</a> tool <a class="reference internal" href="#id1">[1]</a>.
The <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> can be initialized with a list of backends, a <a class="reference external" href="https://quantum.cloud.ibm.com/docs/api/qiskit-ibm-runtime/qiskit-runtime-service" title="(in Qiskit Runtime IBM Client)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QiskitRuntimeService</span></code></a>, or a Qiskit
Session, and the most suitable backend is chosen automatically. The selection process can be
set to two modes: <code class="docutils literal notranslate"><span class="pre">&quot;quality&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;speed&quot;</span></code>.</p></li>
<li><p><strong>In-QPU parallelization (Qiskit only):</strong> The <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class supports QPU (Quantum Processing Unit)
parallelization for Qiskit backends, enabling simultaneous measurements of the same quantum
circuit on the quantum hardware by duplicating the circuit.</p></li>
</ul>
</section>
<section id="initialization-of-the-executor-class">
<h2>Initialization of the Executor class<a class="headerlink" href="#initialization-of-the-executor-class" title="Link to this heading"></a></h2>
<p>The Estimator can be initialized with various inputs (<code class="docutils literal notranslate"><span class="pre">execution=</span></code>) that specify the
execution environment:</p>
<ul>
<li><p>Default initialization with no backend specified: If no backend is specified, the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a>
class is initialized utilizing PennyLane’s <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.devices.default_qubit.DefaultQubit.html#pennylane.devices.default_qubit.DefaultQubit" title="(in PennyLane v0.43)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DefaultQubit</span></code></a> simulator.
If no shots are specified (<code class="docutils literal notranslate"><span class="pre">shots=None</span></code>) the simulator is utilized as a statevector simulator by default. If shots are specified, a shot-based simulator is utilized.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="c1"># Initialize the Executor with the PennyLane statevector simulator</span>
<span class="c1"># as default, shots=None (statevector simulator)</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">()</span>

<span class="c1"># Initialize the Executor with the PennyLane shot-based simulator</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">shots</span><span class="o">=</span><span class="mi">1234</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</li>
<li><p>A string specifying the local simulator backend: Qiskit’s <a class="reference external" href="https://qiskit.github.io/qiskit-aer/stubs/qiskit_aer.AerSimulator.html#qiskit_aer.AerSimulator" title="(in Qiskit Aer v0.17.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerSimulator</span></code></a> is available by providing <code class="docutils literal notranslate"><span class="pre">&quot;qiskit&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;statevector_simulator&quot;</span></code> and  <code class="docutils literal notranslate"><span class="pre">&quot;qasm_simulator&quot;</span></code>; PennyLane’s <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.devices.default_qubit.DefaultQubit.html#pennylane.devices.default_qubit.DefaultQubit" title="(in PennyLane v0.43)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DefaultQubit</span></code></a> simulator can be initialized by
<code class="docutils literal notranslate"><span class="pre">&quot;pennylane&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;default.qubit&quot;</span></code>. The Qulacs statevector simulator can be used with the keyword <code class="docutils literal notranslate"><span class="pre">&quot;qulacs&quot;</span></code>.
Note that with Qiskit version 1.2, the sampler routines will always performe shots for the <code class="docutils literal notranslate"><span class="pre">&quot;statevector_simulator&quot;</span></code> keyword.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="c1"># Initialize the Executor with the statevector simulator</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="s2">&quot;statevector_simulator&quot;</span><span class="p">)</span>

<span class="c1"># Initialize the Executor with the qasm simulator</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="s2">&quot;qasm_simulator&quot;</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1234</span><span class="p">)</span>

<span class="c1"># Initialize the Executor with qiksit is equivalent to &quot;statevector_simulator&quot;</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="s2">&quot;qiskit&quot;</span><span class="p">)</span>

<span class="c1"># Initialize the Executor with the PennyLane statevector simulator</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="s2">&quot;pennylane&quot;</span><span class="p">)</span>

<span class="c1"># Initialize the Executor with the PennyLane shot-based simulator</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="s2">&quot;default.qubit&quot;</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1234</span><span class="p">)</span>

<span class="c1"># Initialize the Executor with the Qulacs statevector simulator</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="s2">&quot;qulacs&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</li>
<li><p>A Qiskit <a class="reference external" href="https://quantum.cloud.ibm.com/docs/api/qiskit/qiskit.providers.Backend" title="(in Qiskit v2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Backend</span></code></a>, e.g. a <a class="reference external" href="https://qiskit.github.io/qiskit-aer/stubs/qiskit_aer.AerProvider.html#qiskit_aer.AerProvider" title="(in Qiskit Aer v0.17.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerProvider</span></code></a> backend or a <a class="reference external" href="https://quantum.cloud.ibm.com/docs/api/qiskit-ibm-runtime/fake-provider#module-qiskit_ibm_runtime.fake_provider" title="(in Qiskit Runtime IBM Client)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fake_provider</span></code></a> backend. This allows also the utilization
of other quantum computing backends, as long as they provide a Qiskit <a class="reference external" href="https://quantum.cloud.ibm.com/docs/api/qiskit/qiskit.providers.Backend" title="(in Qiskit v2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Backend</span></code></a> class.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">qiskit_aer</span> <span class="kn">import</span> <span class="n">Aer</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_runtime.fake_provider</span> <span class="kn">import</span> <span class="n">FakeManilaV2</span>

<span class="c1"># Executor with the Aer statevector simulator</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">Aer</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s2">&quot;aer_simulator&quot;</span><span class="p">))</span>

<span class="c1"># Executor with the FakeManilaV2 backend</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">FakeManilaV2</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</li>
<li><p>A PennyLane device of a quantum computing backend obtained with <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.device.html#pennylane.device" title="(in PennyLane v0.43)"><code class="xref py py-func docutils literal notranslate"><span class="pre">pennylane.device()</span></code></a>. In the following example, the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> is
initialized with a AWS device. Note that this example requires the PennyLane AWS plugin to be
installed (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">amazon-braket-pennylane-plugin</span></code>) and the AWS credentials to be
configured. A full list of plugins for PennyLane can be found <a class="reference external" href="https://pennylane.ai/plugins/#plugins">here</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">import</span> <span class="nn">pennylane</span> <span class="k">as</span> <span class="nn">qml</span>

<span class="c1"># Initialize the Executor with the PennyLane default.qubit device</span>
<span class="n">dev</span> <span class="o">=</span> <span class="n">qml</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;braket.aws.qubit&quot;</span><span class="p">,</span> <span class="n">device_arn</span><span class="o">=</span><span class="s2">&quot;arn:aws:braket:::device/quantum-simulator/amazon/sv1&quot;</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">shots</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>A <a class="reference external" href="https://quantum.cloud.ibm.com/docs/api/qiskit/qiskit.providers.Backend" title="(in Qiskit v2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Backend</span></code></a> from <a class="reference external" href="https://quantum.cloud.ibm.com/docs/api/qiskit-ibm-runtime/qiskit-runtime-service" title="(in Qiskit Runtime IBM Client)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QiskitRuntimeService</span></code></a>’s <code class="xref py py-meth docutils literal notranslate"><span class="pre">backend</span></code> method, which utilizes the execution of quantum jobs on IBM Quantum.
Sessions and Primitives are automatically created and managed by the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class (remember to close the session at the end of your code when running on IBM Quantum).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_runtime</span> <span class="kn">import</span> <span class="n">QiskitRuntimeService</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">QiskitRuntimeService</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;ibm_quantum&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;INSERT_YOUR_TOKEN_HERE&quot;</span><span class="p">)</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">backend</span><span class="p">(</span><span class="s1">&#39;ibm_brisbane&#39;</span><span class="p">))</span>
<span class="o">...</span>
<span class="c1"># Close the session at the end of your code</span>
<span class="n">executor</span><span class="o">.</span><span class="n">close_session</span><span class="p">()</span>
</pre></div>
</div>
<p>It is also possible to pass a list of IBM Quantum backends from which the most suited backend is chosen
automatically (see <a class="reference internal" href="#autoselect"><span class="std std-ref">Automatic backend selection</span></a>)</p>
</li>
<li><p>Another way is to just pass the <a class="reference external" href="https://quantum.cloud.ibm.com/docs/api/qiskit-ibm-runtime/qiskit-runtime-service" title="(in Qiskit Runtime IBM Client)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QiskitRuntimeService</span></code></a> to the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a>. In this case, the backend
will be chosen automatically, for more details see <a class="reference internal" href="#autoselect"><span class="std std-ref">Automatic backend selection</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_runtime</span> <span class="kn">import</span> <span class="n">QiskitRuntimeService</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">QiskitRuntimeService</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;ibm_quantum&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;INSERT_YOUR_TOKEN_HERE&quot;</span><span class="p">)</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>A pre-initialized <a class="reference external" href="https://quantum.cloud.ibm.com/docs/api/qiskit-ibm-runtime/session" title="(in Qiskit Runtime IBM Client)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> object, which can be used to execute quantum jobs on the <a class="reference external" href="https://quantum.cloud.ibm.com/docs/api/qiskit-ibm-runtime/qiskit-runtime-service" title="(in Qiskit Runtime IBM Client)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QiskitRuntimeService</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_runtime</span> <span class="kn">import</span> <span class="n">QiskitRuntimeService</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">QiskitRuntimeService</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;ibm_quantum&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;INSERT_YOUR_TOKEN_HERE&quot;</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span><span class="n">backend</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">backend</span><span class="p">(</span><span class="s1">&#39;ibm_brisbane&#39;</span><span class="p">))</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">executor</span><span class="o">.</span><span class="n">close_session</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Pre-configured Primitive (<code class="xref py py-class docutils literal notranslate"><span class="pre">Estimator</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Sampler</span></code>) with options for error mitigation.
Note that the options from an <code class="xref py py-class docutils literal notranslate"><span class="pre">Estimator</span></code> are not automatically copied to
the <code class="xref py py-class docutils literal notranslate"><span class="pre">Sampler</span></code>, and vice versa.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_runtime</span> <span class="kn">import</span> <span class="n">QiskitRuntimeService</span><span class="p">,</span> <span class="n">Estimator</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">QiskitRuntimeService</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;ibm_quantum&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;INSERT_YOUR_TOKEN_HERE&quot;</span><span class="p">)</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span><span class="n">backend</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">backend</span><span class="p">(</span><span class="s1">&#39;ibm_brisbane&#39;</span><span class="p">))</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">Estimator</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
<span class="n">estimator</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">resilience</span><span class="o">.</span><span class="n">zne_mitigation</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">estimator</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">resilience</span><span class="o">.</span><span class="n">zne</span><span class="o">.</span><span class="n">noise_factors</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">estimator</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">resilience</span><span class="o">.</span><span class="n">zne</span><span class="o">.</span><span class="n">extrapolator</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>

<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">executor</span><span class="o">.</span><span class="n">close_session</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>If only the <code class="docutils literal notranslate"><span class="pre">backend.run</span></code> execution is wanted, this can be achieved by utilizing the
Qiskit IBM Provider package. However, most sQUlearn algorithms a build upon primitives,
and therefore, this access is not recommended, since it is likely to be deprecated in the future.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_provider</span> <span class="kn">import</span> <span class="n">IBMProvider</span>

<span class="n">IBMProvider</span><span class="o">.</span><span class="n">save_account</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s2">&quot;INSERT_YOUR_TOKEN_HERE&quot;</span><span class="p">)</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">IBMProvider</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="s2">&quot;hub/group/project&quot;</span><span class="p">)</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">provider</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s2">&quot;ibmq_qasm_simulator&quot;</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ul>
<p>The following code shows an example for configuring the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class with a
backend from the <a class="reference external" href="https://quantum.cloud.ibm.com/docs/api/qiskit-ibm-runtime/qiskit-runtime-service" title="(in Qiskit Runtime IBM Client)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QiskitRuntimeService</span></code></a> and setting options for caching, logging and restarts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_runtime</span> <span class="kn">import</span> <span class="n">QiskitRuntimeService</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">QiskitRuntimeService</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;ibm_quantum&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;INSERT_YOUR_TOKEN_HERE&quot;</span><span class="p">)</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;resilience&quot;</span><span class="p">:{</span><span class="s2">&quot;zne_mitigation&quot;</span>  <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="s2">&quot;zne&quot;</span><span class="p">:{</span><span class="s2">&quot;noise_factors&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span><span class="s2">&quot;extrapolator&quot;</span><span class="p">:</span><span class="s2">&quot;linear&quot;</span> <span class="p">}}</span>
          <span class="p">}</span>

<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">backend</span><span class="p">(</span><span class="s1">&#39;ibm_brisbane&#39;</span><span class="p">),</span> <span class="c1"># Specify the backend</span>
                     <span class="n">cache_dir</span><span class="o">=</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="c1"># Set cache folder to &quot;cache&quot;</span>
                     <span class="n">caching</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># Enable caching default for remote executions</span>
                     <span class="n">log_file</span><span class="o">=</span><span class="s2">&quot;executor.log&quot;</span><span class="p">,</span> <span class="c1"># Set-up logging file</span>
                     <span class="n">wait_restart</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>  <span class="c1"># Set 10 min pause between restarts of Jobs</span>
                     <span class="n">max_jobs_retries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="c1"># Set maximum number of restarts to 10 before aborting</span>
                     <span class="n">options_estimator</span><span class="o">=</span><span class="n">options</span> <span class="c1"># Set options for the Estimator primitive</span>
                     <span class="p">)</span>

<span class="n">executor</span><span class="o">.</span><span class="n">set_shots</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span> <span class="c1"># Shots can be adjusted after initialization</span>
</pre></div>
</div>
</section>
<section id="utilizing-executor-primitives-in-qiskit-routines">
<h2>Utilizing Executor Primitives in Qiskit Routines<a class="headerlink" href="#utilizing-executor-primitives-in-qiskit-routines" title="Link to this heading"></a></h2>
<p>The <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class provides an <a class="reference internal" href="../modules/generated/squlearn.util.executor.ExecutorEstimator.html#squlearn.util.executor.ExecutorEstimator" title="squlearn.util.executor.ExecutorEstimator"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutorEstimator</span></code></a> and <a class="reference internal" href="../modules/generated/squlearn.util.executor.ExecutorSampler.html#squlearn.util.executor.ExecutorSampler" title="squlearn.util.executor.ExecutorSampler"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutorSampler</span></code></a> primitive that are compatible with the
Qiskit framework. This is only possible, in case the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class is initialized with a backend
compatible with Qiskit (and not PennyLane). The primitives can be obtained by the
<a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor.get_estimator" title="squlearn.Executor.get_estimator"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_estimator()</span></code></a> and <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor.get_sampler" title="squlearn.Executor.get_sampler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_sampler()</span></code></a> methods of the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class.
The primitives automatically utilized the parent <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class for all executions,
and thus benefit from all comfort features of the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a>.</p>
<p>The following example shows, how to evaluate the Quantum Fisher Information utilizing the
<a class="reference internal" href="../modules/generated/squlearn.util.executor.ExecutorEstimator.html#squlearn.util.executor.ExecutorEstimator" title="squlearn.util.executor.ExecutorEstimator"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutorEstimator</span></code></a> primitive (see <a class="reference external" href="https://qiskit-community.github.io/qiskit-algorithms/stubs/qiskit_algorithms.gradients.QFI.html">QFI in Qiskit</a>)
The following code runs only for a Qiskit version below 1.2, since the QFI Routines have not been updated to PrimitivesV2 yet.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">qiskit_algorithms.gradients</span> <span class="kn">import</span> <span class="n">LinCombQGT</span><span class="p">,</span> <span class="n">QFI</span>
<span class="kn">from</span> <span class="nn">qiskit.quantum_info</span> <span class="kn">import</span> <span class="n">Pauli</span>
<span class="c1"># Executor initialization (other ways are possible, see above)</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">execution</span><span class="o">=</span><span class="s2">&quot;statevector_simulator&quot;</span><span class="p">)</span>
<span class="c1"># This creates the QFI primitive that utilizes the Estimator of the Executor class</span>
<span class="n">qfi</span> <span class="o">=</span> <span class="n">QFI</span><span class="p">(</span><span class="n">LinCombQGT</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">get_estimator</span><span class="p">()))</span>
<span class="c1"># Quantum Fischer Information can be evaluated as usual with qfi.run()</span>
</pre></div>
</div>
</div></blockquote>
<p>If only the run function of the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> Primitive is wanted, this can be achieved by utilizing the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class function <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor.estimator_run_v1" title="squlearn.Executor.estimator_run_v1"><code class="xref py py-meth docutils literal notranslate"><span class="pre">estimator_run_v1()</span></code></a> and <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor.sampler_run_v1" title="squlearn.Executor.sampler_run_v1"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sampler_run_v1()</span></code></a> for V1 Primitives.
If the Qiskit version is larger than 1, also the functions <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor.estimator_run_v2" title="squlearn.Executor.estimator_run_v2"><code class="xref py py-meth docutils literal notranslate"><span class="pre">estimator_run_v2()</span></code></a> and <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor.sampler_run_v2" title="squlearn.Executor.sampler_run_v2"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sampler_run_v2()</span></code></a> are available with the V2 Primitive interface.</p>
<p>Note that the attributes <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor.estimator" title="squlearn.Executor.estimator"><code class="xref py py-meth docutils literal notranslate"><span class="pre">estimator()</span></code></a> and <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor.sampler" title="squlearn.Executor.sampler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sampler()</span></code></a> of the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class are
not creating or referring to the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> primitives! Instead, they refer to the
Qiskit Primitives used internally that do not utilize any caching, restarts, etc.</p>
</section>
<section id="setting-options-for-qiskit-primitives">
<h2>Setting Options for Qiskit Primitives<a class="headerlink" href="#setting-options-for-qiskit-primitives" title="Link to this heading"></a></h2>
<p>Options for the Primitives can be provided as a <code class="xref py py-class docutils literal notranslate"><span class="pre">Options</span></code> object to the <code class="docutils literal notranslate"><span class="pre">options_estimator</span></code> and
<code class="docutils literal notranslate"><span class="pre">options_sampler</span></code> arguments, but they are also automatically copied from inputted primitives.
They folow the same dictionary datastructure than the original V2 Primtives.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_runtime</span> <span class="kn">import</span> <span class="n">QiskitRuntimeService</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">QiskitRuntimeService</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;ibm_quantum&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;INSERT_YOUR_TOKEN_HERE&quot;</span><span class="p">)</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;resilience&quot;</span><span class="p">:{</span><span class="s2">&quot;zne_mitigation&quot;</span>  <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="s2">&quot;zne&quot;</span><span class="p">:{</span><span class="s2">&quot;noise_factors&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span><span class="s2">&quot;extrapolator&quot;</span><span class="p">:</span><span class="s2">&quot;linear&quot;</span> <span class="p">}}</span>
          <span class="p">}</span>

<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">backend</span><span class="p">(</span><span class="s2">&quot;ibm_brisbane&quot;</span><span class="p">),</span><span class="n">options_estimator</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, the options can be adjusted by the attributes <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor.estimator_options" title="squlearn.Executor.estimator_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">estimator_options()</span></code></a> and <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor.sampler_options" title="squlearn.Executor.sampler_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sampler_options()</span></code></a> similar
to the option interface of the V2 Primtives:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_runtime</span> <span class="kn">import</span> <span class="n">QiskitRuntimeService</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">QiskitRuntimeService</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;ibm_quantum&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;INSERT_YOUR_TOKEN_HERE&quot;</span><span class="p">)</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">backend</span><span class="p">(</span><span class="s2">&quot;ibm_brisbane&quot;</span><span class="p">))</span>
<span class="n">executor</span><span class="o">.</span><span class="n">sampler_options</span><span class="o">.</span><span class="n">dynamical_decoupling</span><span class="o">.</span><span class="n">enable</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">executor</span><span class="o">.</span><span class="n">sampler_options</span><span class="o">.</span><span class="n">dynamical_decoupling</span><span class="o">.</span><span class="n">sequence_type</span> <span class="o">=</span> <span class="s2">&quot;XpXm&quot;</span>
</pre></div>
</div>
<p>Options can be adjusted by the <code class="xref py py-meth docutils literal notranslate"><span class="pre">set_options()</span></code> method of the Primitives that are created by the
<a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_runtime</span> <span class="kn">import</span> <span class="n">QiskitRuntimeService</span><span class="p">,</span> <span class="n">Options</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">QiskitRuntimeService</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;ibm_quantum&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;INSERT_YOUR_TOKEN_HERE&quot;</span><span class="p">)</span>

<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">backend</span><span class="p">(</span><span class="s2">&quot;ibm_brisbane&quot;</span><span class="p">))</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_estimator</span><span class="p">()</span>
<span class="n">estimator</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">resilience_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="automatic-backend-selection-ibm-quantum-only">
<span id="autoselect"></span><h2>Automatic backend selection (IBM Quantum only)<a class="headerlink" href="#automatic-backend-selection-ibm-quantum-only" title="Link to this heading"></a></h2>
<p>sQUlearn offers automatic determination of the most suitable Qiskit backend for the
Quantum Machine Learning (QML) problem. This is facilitated by initializing the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> with a
list of supported backends, which includes real IBM backends or simulated fake backends.
Alternatively, users can pass a <a class="reference external" href="https://quantum.cloud.ibm.com/docs/api/qiskit-ibm-runtime/qiskit-runtime-service" title="(in Qiskit Runtime IBM Client)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QiskitRuntimeService</span></code></a>, where all appropriate backends
are automatically considered. The selection process leverages the mapomatic tool <a class="reference internal" href="#id1">[1]</a> and also
identifies the best transpilation for each backend.</p>
<p>Two modes for backend selection are currently implemented:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;quality&quot;</span></code>: This mode automatically selects the best backend, which is also the default
setting. An estimation of the expected error is calculated for the optimal
transpiled circuit of the QML model. Backend selection is performed by the
mapomatic tool.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;speed&quot;</span></code>: In this mode, the backend with the smallest queue is automatically selected.</p></li>
</ul>
<p>Once a backend is chosen, it remains fixed throughout the program unless explicitly changed.
It’s worth noting that if other QML models are initialized, the chosen backend remains
consistent. The backend selection can be unset using the unset_backend method.
However, it’s important to note that this action only triggers the selection process for
QML models initialized thereafter.</p>
<p>Below is an example demonstrating the selection of different simulated noisy IBM backends.
We set up a small <a class="reference internal" href="../modules/generated/squlearn.qnn.QNNRegressor.html#squlearn.qnn.QNNRegressor" title="squlearn.qnn.QNNRegressor"><code class="xref py py-class docutils literal notranslate"><span class="pre">QNNRegressor</span></code></a> example and train it on the most suitable backend:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_runtime.fake_provider</span> <span class="kn">import</span> <span class="n">FakeManilaV2</span><span class="p">,</span> <span class="n">FakeBelemV2</span><span class="p">,</span> <span class="n">FakeAthensV2</span>
<span class="kn">from</span> <span class="nn">squlearn.util</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">squlearn.qnn</span> <span class="kn">import</span> <span class="n">QNNRegressor</span>
<span class="kn">from</span> <span class="nn">squlearn.observables</span> <span class="kn">import</span> <span class="n">SummedPaulis</span>
<span class="kn">from</span> <span class="nn">squlearn.encoding_circuit</span> <span class="kn">import</span> <span class="n">ChebyshevPQC</span>
<span class="kn">from</span> <span class="nn">squlearn.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<span class="kn">from</span> <span class="nn">squlearn.qnn.loss</span> <span class="kn">import</span> <span class="n">SquaredLoss</span>

<span class="n">backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">FakeBelemV2</span><span class="p">(),</span> <span class="n">FakeAthensV2</span><span class="p">(),</span> <span class="n">FakeManilaV2</span><span class="p">()]</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">backends</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">qnn</span> <span class="o">=</span> <span class="n">QNNRegressor</span><span class="p">(</span>
    <span class="n">ChebyshevPQC</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">SummedPaulis</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">executor</span><span class="p">,</span>
    <span class="n">SquaredLoss</span><span class="p">(),</span>
    <span class="n">Adam</span><span class="p">({</span><span class="s1">&#39;maxiter&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}),</span> <span class="c1"># Two iteration for demonstration purposes only</span>
    <span class="n">callback</span><span class="o">=</span><span class="kc">None</span> <span class="c1"># Remove print of the progress bar for cleaner output</span>
<span class="p">)</span>
<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
   <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
   <span class="n">qnn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.25</span><span class="p">],[</span><span class="mf">0.75</span><span class="p">]]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.75</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Chosen backend:&quot;</span><span class="p">,</span> <span class="n">executor</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Chosen backend: &lt;qiskit_ibm_runtime.fake_provider.backends.manila.fake_manila.FakeManilaV2 object at 0x7fee501b0bc0&gt;
</pre></div>
</div>
</div>
</div>
<p>In the following example, the service is used for initializing the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a>, and
the mode is switched to <code class="docutils literal notranslate"><span class="pre">&quot;speed&quot;</span></code>. The <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> is then utilized for running a
<a class="reference internal" href="../modules/generated/squlearn.kernel.QKRR.html#squlearn.kernel.QKRR" title="squlearn.kernel.QKRR"><code class="xref py py-class docutils literal notranslate"><span class="pre">QKRR</span></code></a> in which the backend is chosen automatically.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_runtime</span> <span class="kn">import</span> <span class="n">QiskitRuntimeService</span>
<span class="kn">from</span> <span class="nn">squlearn.encoding_circuit</span> <span class="kn">import</span> <span class="n">ChebyshevRx</span>
<span class="kn">from</span> <span class="nn">squlearn.kernel.lowlevel_kernel</span> <span class="kn">import</span> <span class="n">FidelityKernel</span><span class="p">,</span> <span class="n">QKRR</span>

<span class="c1"># Executor is initialized with a service, and considers all available backends</span>
<span class="c1"># (except simulators)</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">QiskitRuntimeService</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="s2">&quot;ibm_quantum&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="s2">&quot;INSERT_YOUR_TOKEN_HERE&quot;</span><span class="p">)</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">auto_backend_mode</span><span class="o">=</span><span class="s2">&quot;speed&quot;</span><span class="p">)</span>

<span class="c1"># Create a QKRR model with a FidelityKernel and the ChebyshevRx encoding circuit</span>
<span class="n">qkrr</span> <span class="o">=</span> <span class="n">QKRR</span><span class="p">(</span><span class="n">FidelityKernel</span><span class="p">(</span><span class="n">ChebyshevRx</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">executor</span><span class="p">))</span>

<span class="c1"># Backend is automatically selected based on the smallest queue</span>
<span class="c1"># All the following functions will be executed on the selected backend</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.1</span><span class="p">],[</span><span class="mf">0.2</span><span class="p">]]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">])</span>
<span class="n">qkrr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="in-qpu-parallelization-qiskit-only">
<h2>In-QPU parallelization (Qiskit only)<a class="headerlink" href="#in-qpu-parallelization-qiskit-only" title="Link to this heading"></a></h2>
<p>The <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> class supports QPU (Quantum Processing Unit) parallelization for Qiskit backends, enabling simultaneous
measurements of the same quantum circuit on the quantum hardware by duplicating the circuit.
This feature significantly enhances the efficiency of quantum computation by reducing the number
of required shots.
However, it’s essential to note that utilizing QPU parallelization may introduce additional noise
and hardware errors due to increased qubit utilization and crosstalk.</p>
<p>The QPU parallelization parameter <code class="docutils literal notranslate"><span class="pre">qpu_parallelization</span></code> determines the number of parallel
evaluations of the Quantum Circuit on the QPU. When <code class="docutils literal notranslate"><span class="pre">qpu_parallelization</span></code> is set to an <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>
value, it specifies the exact number of parallel executions, for instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">qpu_parallelization</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>This configuration instructs the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> to duplicate all circuit executions four times and
execute them concurrently on the QPU.</p>
<p>Alternatively, setting <code class="docutils literal notranslate"><span class="pre">qpu_parallelization</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;auto&quot;</span></code> enables automatic determination of
the parallelization level. In this mode, the <a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a> dynamically adjusts the degree of
parallelization to maximize the number of possible parallel circuit measurements, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">qpu_parallelization</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If activated, QPU parallelization is automatically applied to all Primitives created by the
<a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a>. By leveraging QPU parallelization, users can expedite the execution of quantum
circuits on real hardware. Nonetheless, it’s crucial to weigh the benefits against the potential
drawbacks of increased noise and errors. By default, <code class="docutils literal notranslate"><span class="pre">qpu_parallelization</span></code> is set to <code class="docutils literal notranslate"><span class="pre">None</span></code>,
implying no parallelization is considered unless explicitly specified.
The transpilation considers the duplicated circuits, hence the duplicated circuits are placed
accordingly to the qubit layout of the backend.
In principle, this feature can be used in combination with the automatic backend selection,
but the backend selection process might take a substantial time due to the increased number of
circuits that need to be transpiled.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference internal" href="../modules/generated/squlearn.Executor.html#squlearn.Executor" title="squlearn.Executor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.quantum.ibm.com/api/qiskit-ibm-runtime">Qiskit Runtime</a></p></li>
<li><p><a class="reference external" href="https://docs.quantum.ibm.com/api/qiskit/primitives">Qsikit Primitives</a></p></li>
<li><p><a class="reference external" href="https://github.com/qiskit-community/mapomatic">Mapomatic: Automatic mapping of compiled circuits to low-noise sub-graphs</a></p></li>
<li><p><a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.device.html">PennyLane Devices</a></p></li>
<li><p><a class="reference external" href="http://docs.qulacs.org/en/latest">Qulacs</a></p></li>
</ul>
</div>
<p class="rubric">References</p>
<p><span class="target" id="id1">[1]</span> P. D. Nation and M. Treinish “Suppressing quantum circuit errors due to system variability”.
<a class="reference external" href="https://journals.aps.org/prxquantum/abstract/10.1103/PRXQuantum.4.010327">PRX Quantum 4(1) 010327</a> (2023)</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="user_guide_index.html" class="btn btn-neutral float-left" title="User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="observables.html" class="btn btn-neutral float-right" title="Observables for expectation values" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Fraunhofer IPA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>