<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hyperparameter Optimization and Pipelines &mdash; sQUlearn 0.4.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=4e78f113"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bayesian Optimization using a Quantum Gaussian Process Surrogate Model" href="example_quantum_bayesian_optimization.html" />
    <link rel="prev" title="Handwritten Digit Recognition with Projected Quantum Kernels" href="example_kernel_digit_classification.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            sQUlearn
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/user_guide_index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/classes.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples_index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="example_kernel_digit_classification.html">Handwritten Digit Recognition with Projected Quantum Kernels</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Hyperparameter Optimization and Pipelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Importing-Libraries">Importing Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Generating-Data">Generating Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Setting-up-the-kernels">Setting up the kernels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Setting-up-the-grid-search">Setting up the grid search</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Running-Grid-Search">Running Grid Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Results-Analysis">Results Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="example_quantum_bayesian_optimization.html">Bayesian Optimization using a Quantum Gaussian Process Surrogate Model</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sQUlearn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="examples_index.html">Examples</a></li>
      <li class="breadcrumb-item active">Hyperparameter Optimization and Pipelines</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/example_kernel_grid_search.nblink.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Hyperparameter-Optimization-and-Pipelines">
<h1>Hyperparameter Optimization and Pipelines<a class="headerlink" href="#Hyperparameter-Optimization-and-Pipelines" title="Permalink to this heading"></a></h1>
<section id="Summary">
<h2>Summary<a class="headerlink" href="#Summary" title="Permalink to this heading"></a></h2>
<p>This tutorial demonstrates how to integrate quantum machine learning algorithms, specifically quantum kernel methods, from the <code class="docutils literal notranslate"><span class="pre">squlearn</span></code> library with traditional machine learning workflows in <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>. We’ll go through data generation, preprocessing, model definition, and hyperparameter optimization using GridSearchCV. The objective is to highlight that squlearn algorithms can be seamlessly used alongside classical algorithms.</p>
</section>
<section id="Importing-Libraries">
<h2>Importing Libraries<a class="headerlink" href="#Importing-Libraries" title="Permalink to this heading"></a></h2>
<p>In this initial cell, we are importing all the libraries required for the tutorial. We are using <code class="docutils literal notranslate"><span class="pre">squlearn</span></code> for quantum kernel methods like Quantum Support Vector Regression (QSVR) and Quantum Gaussian Process Regression (QGPR). For tasks like data scaling and hyperparameter optimization, we rely on <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="kn">from</span> <span class="nn">squlearn</span> <span class="kn">import</span> <span class="n">Executor</span>
<span class="kn">from</span> <span class="nn">squlearn.encoding_circuit</span> <span class="kn">import</span> <span class="n">YZ_CX_EncodingCircuit</span>
<span class="kn">from</span> <span class="nn">squlearn.kernel.matrix</span> <span class="kn">import</span> <span class="n">FidelityKernel</span><span class="p">,</span> <span class="n">ProjectedQuantumKernel</span>
<span class="kn">from</span> <span class="nn">squlearn.kernel.ml</span> <span class="kn">import</span> <span class="n">QGPR</span><span class="p">,</span> <span class="n">QSVR</span>
</pre></div>
</div>
</div>
</section>
<section id="Generating-Data">
<h2>Generating Data<a class="headerlink" href="#Generating-Data" title="Permalink to this heading"></a></h2>
<p>Here, synthetic data is generated. We sample a training data set where we perform a grid search on. We also create hold-out test data which will be used to score the best estimator of the grid search.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_y</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">/</span> <span class="n">u</span>


<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># define training and test data</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">generate_y</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">generate_y</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>

<span class="n">x_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">generate_y</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ground Truth&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Training Data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test Data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x1ccd24cc160&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_example_kernel_grid_search_4_1.png" src="../_images/examples_example_kernel_grid_search_4_1.png" />
</div>
</div>
</section>
<section id="Setting-up-the-kernels">
<h2>Setting up the kernels<a class="headerlink" href="#Setting-up-the-kernels" title="Permalink to this heading"></a></h2>
<p>We want to compare two QML algorithms with the same encoding circuit and two variants of calculating the kernel: Fidelity kernels and projected quantum kernels. We set up the encoding circuit with initial parameters. These will be varied during the grid search. The kernel instances are initialized using Qiskit’s StatevectorSimulator.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoding_circuit</span> <span class="o">=</span> <span class="n">YZ_CX_EncodingCircuit</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_features</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">executor</span> <span class="o">=</span> <span class="n">Executor</span><span class="p">(</span><span class="s2">&quot;statevector_simulator&quot;</span><span class="p">)</span>

<span class="n">fidelity_kernel</span> <span class="o">=</span> <span class="n">FidelityKernel</span><span class="p">(</span>
    <span class="n">encoding_circuit</span><span class="o">=</span><span class="n">encoding_circuit</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">,</span> <span class="n">parameter_seed</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
<span class="n">projected_kernel</span> <span class="o">=</span> <span class="n">ProjectedQuantumKernel</span><span class="p">(</span>
    <span class="n">encoding_circuit</span><span class="o">=</span><span class="n">encoding_circuit</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">,</span> <span class="n">parameter_seed</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="n">encoding_circuit</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<pre style="word-wrap: normal;white-space: pre;background: #fff0;line-height: 1.1;font-family: &quot;Courier New&quot;,Courier,monospace">     ┌─────────────────────┐┌─────────────────────┐     »
q_0: ┤ Ry(p[0] + 1.0*x[0]) ├┤ Rz(p[1] + 1.0*x[0]) ├──■──»
     ├─────────────────────┤├─────────────────────┤┌─┴─┐»
q_1: ┤ Ry(p[2] + 1.0*x[0]) ├┤ Rz(p[3] + 1.0*x[0]) ├┤ X ├»
     ├─────────────────────┤├─────────────────────┤└───┘»
q_2: ┤ Ry(p[4] + 1.0*x[0]) ├┤ Rz(p[5] + 1.0*x[0]) ├──■──»
     ├─────────────────────┤├─────────────────────┤┌─┴─┐»
q_3: ┤ Ry(p[6] + 1.0*x[0]) ├┤ Rz(p[7] + 1.0*x[0]) ├┤ X ├»
     └─────────────────────┘└─────────────────────┘└───┘»
«     ┌─────────────────────┐ ┌─────────────────────┐
«q_0: ┤ Ry(p[8] + 1.0*x[0]) ├─┤ Rz(p[9] + 1.0*x[0]) ├──────
«     ├─────────────────────┴┐├─────────────────────┴┐
«q_1: ┤ Ry(p[10] + 1.0*x[0]) ├┤ Rz(p[11] + 1.0*x[0]) ├──■──
«     ├──────────────────────┤├──────────────────────┤┌─┴─┐
«q_2: ┤ Ry(p[12] + 1.0*x[0]) ├┤ Rz(p[13] + 1.0*x[0]) ├┤ X ├
«     ├──────────────────────┤├──────────────────────┤└───┘
«q_3: ┤ Ry(p[14] + 1.0*x[0]) ├┤ Rz(p[15] + 1.0*x[0]) ├─────
«     └──────────────────────┘└──────────────────────┘     </pre></div>
</div>
</section>
<section id="Setting-up-the-grid-search">
<h2>Setting up the grid search<a class="headerlink" href="#Setting-up-the-grid-search" title="Permalink to this heading"></a></h2>
<p>In this section, we define the quantum kernel methods we’ll be using for regression: Quantum Support Vector Regression (QSVR) and Quantum Gaussian Process Regression (QGPR). We initialize both with the two kernel-variants from above</p>
<p>We use <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> from <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> to perform hyperparameter optimization. The hyperparameters include the number of qubits and layers for the quantum encoding circuits.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_qubit_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">num_layers_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">encoding_circuit_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;estimator__num_qubits&quot;</span><span class="p">:</span> <span class="n">num_qubit_list</span><span class="p">,</span>
    <span class="s2">&quot;estimator__num_layers&quot;</span><span class="p">:</span> <span class="n">num_layers_list</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">estimator_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">QGPR</span><span class="p">(</span><span class="n">quantum_kernel</span><span class="o">=</span><span class="n">fidelity_kernel</span><span class="p">,</span> <span class="n">full_regularization</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">QGPR</span><span class="p">(</span><span class="n">quantum_kernel</span><span class="o">=</span><span class="n">projected_kernel</span><span class="p">,</span> <span class="n">full_regularization</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">QSVR</span><span class="p">(</span><span class="n">quantum_kernel</span><span class="o">=</span><span class="n">fidelity_kernel</span><span class="p">),</span>
    <span class="n">QSVR</span><span class="p">(</span><span class="n">quantum_kernel</span><span class="o">=</span><span class="n">projected_kernel</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="n">estimator_list</span><span class="p">:</span>
    <span class="n">estimator_params</span> <span class="o">=</span> <span class="n">encoding_circuit_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">estimator_params</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">estimator</span><span class="p">]</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estimator_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To scale the data, we use scikit-learns <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code>. This ensures that each feature has a mean of 0 and a standard deviation of 1, making it easier for the model to learn the optimal parameters. We create a pipeline with data scaling and the estimator to ensure that data scaling is part of the cross-validation process. We initialize the pipeline with an estimator. This will be overwritten in the grid search.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="p">[(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span> <span class="p">(</span><span class="s2">&quot;estimator&quot;</span><span class="p">,</span> <span class="n">QGPR</span><span class="p">(</span><span class="n">quantum_kernel</span><span class="o">=</span><span class="n">fidelity_kernel</span><span class="p">))]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Running-Grid-Search">
<h2>Running Grid Search<a class="headerlink" href="#Running-Grid-Search" title="Permalink to this heading"></a></h2>
<p>Now that everything is set up, we execute the grid search by fitting it to the training data. <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> will evaluate every combination of hyperparameters and choose the best set for each estimator (QSVR and QGPR in this case) based on the mean test score.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">)</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GridSearchCV(estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                       (&#39;estimator&#39;,
                                        QGPR(quantum_kernel=&lt;squlearn.kernel.matrix.fidelity_kernel.FidelityKernel object at 0x000001CCD34E0160&gt;))]),
             param_grid=[{&#39;estimator&#39;: [QGPR(full_regularization=False,
                                             quantum_kernel=&lt;squlearn.kernel.matrix.fidelity_kernel.FidelityKernel object at 0x000001CCD34E0160&gt;)],
                          &#39;estimat...
                          &#39;estimator__num_qubits&#39;: [1, 2, 4]},
                         {&#39;estimator&#39;: [QSVR(C=1.0, cache_size=200, epsilon=0.1,
                                             max_iter=-1,
                                             quantum_kernel=&lt;squlearn.kernel.matrix.projected_quantum_kernel.ProjectedQuantumKernel object at 0x000001CCD24CC610&gt;,
                                             shrinking=True, tol=0.001,
                                             verbose=False)],
                          &#39;estimator__num_layers&#39;: [1, 2, 3],
                          &#39;estimator__num_qubits&#39;: [1, 2, 4]}],
             scoring=&#39;neg_mean_squared_error&#39;)
</pre></div></div>
</div>
</section>
<section id="Results-Analysis">
<h2>Results Analysis<a class="headerlink" href="#Results-Analysis" title="Permalink to this heading"></a></h2>
<p>To visualize the performance of different hyperparameter combinations, we plot heat maps for each estimator. Each cell in the heat map represents a combination of the number of qubits and layers used in the quantum encoding circuit, and the color represents the negative mean test score (MSE, larger is better). This allows for an intuitive understanding of how different hyperparameters impact performance.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract the results into a DataFrame</span>
<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>

<span class="c1"># Number of unique combinations per estimator</span>
<span class="n">num_combinations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_qubit_list</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_layers_list</span><span class="p">)</span>

<span class="c1"># Number of estimators</span>
<span class="n">num_estimators</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">estimator_list</span><span class="p">)</span>

<span class="c1"># Initialize the grid for subplots</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">num_estimators</span><span class="p">)))</span>
<span class="n">n_cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_estimators</span> <span class="o">/</span> <span class="n">n_rows</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># Flatten the axis array for easier indexing</span>
<span class="k">if</span> <span class="n">n_rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">n_cols</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># Set min and max for the colormap</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="s2">&quot;mean_test_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">estimator_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;QGPR Fidelity&quot;</span><span class="p">,</span> <span class="s2">&quot;QGPR PQK&quot;</span><span class="p">,</span> <span class="s2">&quot;QSVR Fidelity&quot;</span><span class="p">,</span> <span class="s2">&quot;QSVR Fidelity&quot;</span><span class="p">]</span>
<span class="c1"># Loop through the chunks to plot each heat map</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_estimators</span><span class="p">):</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">num_combinations</span>
    <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">num_combinations</span>
    <span class="n">chunk_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>

    <span class="c1"># Pivot to get a matrix form suitable for heat maps</span>
    <span class="n">heat_map_data</span> <span class="o">=</span> <span class="n">chunk_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="s2">&quot;param_estimator__num_qubits&quot;</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;param_estimator__num_layers&quot;</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="s2">&quot;mean_test_score&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Create the heat map (cbar=False will disable individual colorbars)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">heat_map_data</span><span class="p">,</span>
        <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.3f&quot;</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">estimator_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of Layers&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of Qubits&quot;</span><span class="p">)</span>

<span class="c1"># Add a colorbar with label</span>
<span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">)</span>
<span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;MSE&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\mcr\AppData\Local\Temp\ipykernel_20080\629527406.py:47: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
  plt.tight_layout(rect=[0, 0, 0.9, 1])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_example_kernel_grid_search_14_1.png" src="../_images/examples_example_kernel_grid_search_14_1.png" />
</div>
</div>
<p>The best performing estimator is now evaluated on the test set and its predictions are shown alongside the generating data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the best estimator</span>
<span class="n">best_estimator</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>

<span class="c1"># Score the best estimator on the test set</span>
<span class="n">test_score</span> <span class="o">=</span> <span class="n">best_estimator</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Score: </span><span class="si">{</span><span class="n">test_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Make predictions on the test set</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Plot the predictions and ground truth</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ground Truth&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predictions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Predictions vs Ground Truth&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Test Score: 0.999999978217105
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_example_kernel_grid_search_16_1.png" src="../_images/examples_example_kernel_grid_search_16_1.png" />
</div>
</div>
<p>Note that in the above evaluation, the QSVR did not perform quite as good as the QGPR. The QSVR is, as its classical counterpart, sensitive to additional hyperparameters which have not been varied during the grid search. We now include the classical regularization parameter C and the slack variable epsilon as additional parameters in the search. This also demonstrates that parameters of the quantum kernel and parameters of the classical algorithm can be treated equally during the search.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">QSVR</span><span class="p">(</span><span class="n">quantum_kernel</span><span class="o">=</span><span class="n">fidelity_kernel</span><span class="p">)</span>

<span class="n">estimator_params</span> <span class="o">=</span> <span class="n">encoding_circuit_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">estimator_params</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">QSVR</span><span class="p">(</span><span class="n">quantum_kernel</span><span class="o">=</span><span class="n">fidelity_kernel</span><span class="p">)]</span>
<span class="n">estimator_params</span><span class="p">[</span><span class="s2">&quot;estimator__C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e0</span><span class="p">,</span> <span class="mf">1e1</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">]</span>
<span class="n">estimator_params</span><span class="p">[</span><span class="s2">&quot;estimator__epsilon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">]</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="n">estimator_params</span>

<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">)</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best Score: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best Estimator: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Best Score: -3.0204753114345332e-05
Best Estimator: Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                (&#39;estimator&#39;,
                 QSVR(C=100.0, cache_size=200, epsilon=0.0001, max_iter=-1,
                      quantum_kernel=&lt;squlearn.kernel.matrix.fidelity_kernel.FidelityKernel object at 0x000001CCD3782250&gt;,
                      shrinking=True, tol=0.001, verbose=False))])
</pre></div></div>
</div>
<p>With these more adequate classical hyperparameters, the QSVR performs similarly to the QGPR.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="example_kernel_digit_classification.html" class="btn btn-neutral float-left" title="Handwritten Digit Recognition with Projected Quantum Kernels" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="example_quantum_bayesian_optimization.html" class="btn btn-neutral float-right" title="Bayesian Optimization using a Quantum Gaussian Process Surrogate Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Fraunhofer IPA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>